<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swindler - Dating App | Age Preferences & Smart Matching</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Meet your perfect match with Swindler - the modern dating app">
    <meta name="theme-color" content="#e91e63">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Swindler">
    
    <!-- App Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="mask-icon" href="icons/icon-192x192.png" color="#e91e63">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .app-container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }
        
        .header {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .app-title {
            font-size: 24px;
            font-weight: bold;
            color: #e91e63;
        }
        
        .nav-menu {
            display: flex;
            gap: 15px;
        }
        
        .nav-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background 0.3s;
        }
        
        .nav-btn:hover {
            background: #f5f5f5;
        }
        
        .nav-btn.active {
            background: #e91e63;
            color: white;
        }
        
        .screen {
            display: none;
            padding: 20px;
            height: calc(100vh - 80px);
            overflow-y: auto;
        }
        
        .screen.active {
            display: block;
        }
        
        /* Profile Card Styles */
        .profile-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
        }
        
        .profile-image {
            width: 100%;
            height: 400px;
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 50%, #4facfe 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            color: white;
        }
        
        .profile-info {
            padding: 20px;
        }
        
        .profile-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .profile-details {
            color: #666;
            margin-bottom: 16px;
        }
        
        .profile-bio {
            color: #333;
            line-height: 1.5;
            margin-bottom: 20px;
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 20px;
        }
        
        .action-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .action-btn:hover {
            transform: scale(1.1);
        }
        
        .pass-btn {
            background: #ff4458;
            color: white;
        }
        
        .like-btn {
            background: #42c767;
            color: white;
        }
        
        /* Profile Completion Enforcement */
        .profile-card.blurred {
            position: relative;
        }
        
        .profile-card.blurred .profile-image,
        .profile-card.blurred .profile-info {
            filter: blur(10px);
            pointer-events: none;
        }
        
        .profile-completion-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            padding: 40px 20px;
            text-align: center;
        }
        
        .completion-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.8;
        }
        
        .completion-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 12px;
        }
        
        .completion-message {
            font-size: 16px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 30px;
            max-width: 280px;
        }
        
        .complete-profile-btn {
            background: #e91e63;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(233, 30, 99, 0.3);
        }
        
        .complete-profile-btn:hover {
            background: #c2185b;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(233, 30, 99, 0.4);
        }
        
        .message-btn {
            background: #2196F3;
            color: white;
        }
        
        /* Match Card */
        .match-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .match-card:hover {
            transform: translateY(-2px);
        }
        
        .match-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }
        
        .match-info h3 {
            margin-bottom: 4px;
        }
        
        .match-info p {
            color: #666;
            font-size: 14px;
        }
        
        /* Likes Screen Styles */
        .likes-counter {
            background: linear-gradient(45deg, #ff6b6b, #e91e63);
            color: white;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(233, 30, 99, 0.3);
        }
        
        .current-like-container {
            position: relative;
        }
        
        .like-profile-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 20px;
            border: 3px solid #ff6b6b;
            animation: likeGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes likeGlow {
            0% { box-shadow: 0 8px 32px rgba(0,0,0,0.1), 0 0 20px rgba(255, 107, 107, 0.3); }
            100% { box-shadow: 0 8px 32px rgba(0,0,0,0.1), 0 0 30px rgba(255, 107, 107, 0.6); }
        }
        
        .like-profile-card .profile-photos {
            position: relative;
            height: 400px;
            overflow: hidden;
        }
        
        .like-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #ff6b6b;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            z-index: 10;
            animation: bounce 1s ease-in-out infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .like-actions {
            display: flex;
            gap: 20px;
            padding: 20px;
            justify-content: center;
        }
        
        .like-action-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .like-pass-btn {
            background: #f44336;
            color: white;
        }
        
        .like-pass-btn:hover {
            background: #d32f2f;
            transform: scale(1.1);
        }
        
        .like-match-btn {
            background: #4caf50;
            color: white;
        }
        
        .like-match-btn:hover {
            background: #388e3c;
            transform: scale(1.1);
        }
        
        .likes-queue-info {
            text-align: center;
            padding: 20px;
            background: rgba(255, 107, 107, 0.1);
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .likes-queue-info h3 {
            color: #e91e63;
            margin-bottom: 8px;
        }
        
        .likes-queue-info p {
            color: #666;
            font-size: 14px;
        }
        
        /* Profile Prompts Styles */
        .prompts-section {
            background: linear-gradient(135deg, rgba(233, 30, 99, 0.05), rgba(255, 107, 107, 0.05));
            border: 2px solid rgba(233, 30, 99, 0.1);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 30px;
        }
        
        .prompts-title {
            font-size: 20px;
            font-weight: bold;
            color: #e91e63;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .prompts-description {
            color: #666;
            text-align: center;
            margin-bottom: 24px;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .prompt-answer {
            margin-top: 8px;
            min-height: 80px;
            resize: vertical;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 12px;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }
        
        .prompt-answer:focus {
            border-color: #e91e63;
            outline: none;
            box-shadow: 0 0 0 3px rgba(233, 30, 99, 0.1);
        }
        
        .char-counter {
            text-align: right;
            font-size: 12px;
            color: #999;
            margin-top: 4px;
        }
        
        .char-counter.warning {
            color: #ff9800;
        }
        
        .char-counter.danger {
            color: #f44336;
        }
        
        /* Profile Prompts Display */
        .profile-prompts {
            margin-top: 16px;
        }
        
        .prompt-item {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 12px;
            border-left: 4px solid #e91e63;
        }
        
        .prompt-question {
            font-size: 14px;
            font-weight: 600;
            color: #e91e63;
            margin-bottom: 6px;
        }
        
        .prompt-answer {
            font-size: 14px;
            color: #333;
            line-height: 1.4;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #333;
        }
        
        .form-input, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #e91e63;
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 8px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-checkbox {
            width: 18px;
            height: 18px;
            accent-color: #e91e63;
            cursor: pointer;
        }
        
        .checkbox-label {
            color: #333;
            cursor: pointer;
            font-size: 14px;
            user-select: none;
        }
        
        .preference-note {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
            font-style: italic;
        }
        
        .age-range-container {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
        }
        
        .age-range-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            font-weight: bold;
            color: #495057;
        }
        
        .range-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        .range-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .range-label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }
        
        .age-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        .age-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #e91e63;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(233, 30, 99, 0.3);
        }
        
        .age-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #e91e63;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(233, 30, 99, 0.3);
        }
        
        .range-value {
            font-weight: bold;
            color: #e91e63;
            font-size: 14px;
            min-width: 24px;
            text-align: center;
        }
        
        .btn {
            background: #e91e63;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #c2185b;
        }
        
        .btn-secondary {
            background: #666;
        }
        
        .btn-secondary:hover {
            background: #555;
        }
        
        /* Status messages */
        .status-message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            text-align: center;
        }
        
        .status-success {
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .status-error {
            background: #ffebee;
            color: #c62828;
        }
        
        .status-info {
            background: #e3f2fd;
            color: #1565c0;
        }
        
        .status-warning {
            background: #fff3e0;
            color: #ef6c00;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        /* Animation */
        .card-exit-left {
            animation: slideLeft 0.5s ease-in-out forwards;
        }
        
        .card-exit-right {
            animation: slideRight 0.5s ease-in-out forwards;
        }
        
        @keyframes slideLeft {
            to {
                transform: translateX(-100%) rotate(-20deg);
                opacity: 0;
            }
        }
        
        @keyframes slideRight {
            to {
                transform: translateX(100%) rotate(20deg);
                opacity: 0;
            }
        }
        
        .match-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            display: none;
        }
        
        .match-notification.show {
            display: block;
            animation: matchPop 0.6s ease-out;
        }
        
        @keyframes matchPop {
            0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        /* Location Picker Styles */
        .location-btn {
            position: absolute;
            right: 8px;
            top: 8px;
            background: #e91e63;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .location-btn:hover {
            background: #c2185b;
        }
        
        .location-status {
            font-size: 12px;
            margin-top: 8px;
            padding: 8px;
            border-radius: 4px;
            display: none;
        }
        
        .location-status.success {
            background: #e8f5e8;
            color: #2e7d32;
            display: block;
        }
        
        .location-status.error {
            background: #ffebee;
            color: #c62828;
            display: block;
        }
        
        .location-status.loading {
            background: #e3f2fd;
            color: #1565c0;
            display: block;
        }
        
        /* Map Modal */
        .map-modal {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            background: rgba(0,0,0,0.8) !important;
            z-index: 9999 !important;
            display: none !important;
            align-items: center !important;
            justify-content: center !important;
        }
        
        .map-modal.show {
            display: flex !important;
        }
        
        .map-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            max-width: 90vw;
            max-height: 90vh;
            width: 600px;
            position: relative;
        }
        
        .map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .map-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .map-controls-top {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .search-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .search-btn {
            padding: 10px 15px;
            background: #ff4458;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .map-display {
            width: 100%;
            height: 400px;
            position: relative;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .map-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 10;
        }
        
        .crosshair {
            font-size: 30px;
            color: #ff4458;
            font-weight: bold;
            text-shadow: 0 0 3px white, 0 0 6px white;
            margin-bottom: 10px;
        }
        
        .instruction-text {
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            text-align: center;
            max-width: 200px;
        }
        
        .coordinates {
            text-align: center;
            margin: 15px 0;
            font-family: monospace;
            color: #666;
            font-size: 14px;
        }
        
        .location-info {
            text-align: center;
            margin: 10px 0;
            color: #333;
            font-size: 14px;
        }
        
        .map-pin {
            position: absolute;
            font-size: 32px;
            transform: translate(-50%, -100%);
            transition: all 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        
        .map-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0,0,0,0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .map-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .map-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .map-btn.primary {
            background: #e91e63;
            color: white;
        }
        
        .map-btn.primary:hover {
            background: #c2185b;
        }
        
        .map-btn.secondary {
            background: #f5f5f5;
            color: #333;
        }
        
        .map-btn.secondary:hover {
            background: #e0e0e0;
        }
        
        .coordinates {
            text-align: center;
            font-size: 12px;
            color: #666;
            margin: 10px 0;
        }
        
        @keyframes pinDrop {
            0% { transform: translate(-50%, -200%) scale(0.5); }
            50% { transform: translate(-50%, -120%) scale(1.2); }
            100% { transform: translate(-50%, -100%) scale(1); }
        }
        
        /* Message Modal */
        .message-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .message-modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .message-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            position: relative;
        }
        
        .message-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .message-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .message-subtitle {
            color: #666;
            font-size: 14px;
        }
        
        .message-textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 20px;
        }
        
        .message-textarea:focus {
            outline: none;
            border-color: #e91e63;
        }
        
        .message-actions {
            display: flex;
            gap: 10px;
        }
        
        .message-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .message-btn.primary {
            background: #e91e63;
            color: white;
        }
        
        .message-btn.primary:hover {
            background: #c2185b;
        }
        
        .message-btn.secondary {
            background: #f5f5f5;
            color: #333;
        }
        
        .message-btn.secondary:hover {
            background: #e0e0e0;
        }
        
        /* Like Options */
        .like-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .like-option-btn {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }
        
        .like-option-btn:hover {
            border-color: #e91e63;
            background: #fdf2f8;
        }
        
        .option-icon {
            font-size: 24px;
            min-width: 30px;
        }
        
        .option-title {
            font-weight: 600;
            font-size: 16px;
            color: #333;
            margin-bottom: 4px;
        }
        
        .option-subtitle {
            font-size: 14px;
            color: #666;
        }
        
        .message-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #f0f0f0;
        }
        
        /* Photo Upload */
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .photo-slot {
            aspect-ratio: 3/4;
            border: 2px dashed #ddd;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background: #f9f9f9;
        }
        
        .photo-slot:hover {
            border-color: #e91e63;
            background: #fdf2f8;
        }
        
        .photo-slot.filled {
            border: 2px solid #e91e63;
            padding: 0;
        }
        
        .photo-slot img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
        }
        
        .photo-slot .photo-placeholder {
            text-align: center;
            color: #666;
        }
        
        .photo-slot .photo-number {
            font-size: 24px;
            color: #e91e63;
            margin-bottom: 5px;
        }
        
        .photo-slot .photo-text {
            font-size: 12px;
        }
        
        .photo-slot .remove-photo {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            cursor: pointer;
            display: none;
        }
        
        .photo-slot.filled:hover .remove-photo {
            display: block;
        }
        
        .photo-requirements {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .photo-requirements.error {
            color: #e91e63;
        }
        
        .hidden-file-input {
            display: none;
        }
        
        /* Chat Modal */
        .chat-container {
            background: white;
            width: 100%;
            max-width: 400px;
            height: 90vh;
            max-height: 600px;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        
        .chat-header {
            background: #e91e63;
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .chat-back-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background 0.3s;
        }
        
        .chat-back-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .chat-user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        
        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .chat-user-name {
            font-weight: 600;
            font-size: 16px;
        }
        
        .chat-status {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .chat-options-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .chat-welcome {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .welcome-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .welcome-text {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .welcome-subtext {
            font-size: 14px;
            color: #666;
        }
        
        .chat-message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-end;
            gap: 8px;
        }
        
        .chat-message.sent {
            flex-direction: row-reverse;
        }
        
        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
            position: relative;
        }
        
        .chat-message.received .message-bubble {
            background: white;
            color: #333;
            border-bottom-left-radius: 4px;
        }
        
        .chat-message.sent .message-bubble {
            background: #e91e63;
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .message-time {
            font-size: 11px;
            opacity: 0.6;
            margin-top: 4px;
        }
        
        .chat-input-container {
            padding: 15px 20px;
            background: white;
            border-top: 1px solid #eee;
        }
        
        .chat-input-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f5f5f5;
            border-radius: 25px;
            padding: 8px 15px;
        }
        
        .chat-input {
            flex: 1;
            border: none;
            background: none;
            outline: none;
            font-size: 16px;
            padding: 8px 0;
        }
        
        .chat-send-btn {
            background: #e91e63;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .chat-send-btn:hover {
            background: #c2185b;
        }
        
        .chat-send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .send-icon {
            color: white;
            font-size: 16px;
            transform: rotate(-45deg);
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: white;
            border-radius: 18px;
            margin-bottom: 15px;
            max-width: 70px;
        }
        
        .typing-dots {
            display: flex;
            gap: 3px;
        }
        
        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #999;
            animation: typingAnimation 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typingAnimation {
            0%, 60%, 100% {
                opacity: 0.3;
                transform: scale(0.8);
            }
            30% {
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="app-title">💕 Swindler</div>
            <div class="nav-menu">
                <button class="nav-btn active" onclick="showScreen('discover')" id="discoverBtn">🔍</button>
                <button class="nav-btn" onclick="showScreen('likes')" id="likesBtn">❤️</button>
                <button class="nav-btn" onclick="showScreen('matches')" id="matchesBtn">💬</button>
                <button class="nav-btn" onclick="showScreen('profile')" id="profileBtn">👤</button>
            </div>
        </div>

        <!-- Discover Screen -->
        <div id="discover" class="screen active">
            <div id="profileStack"></div>
            <div id="discoverEmpty" class="empty-state" style="display: none;">
                <div class="empty-state-icon">💔</div>
                <h3>No more profiles</h3>
                <p>Check back later for new people!</p>
            </div>
        </div>

        <!-- Likes Screen -->
        <div id="likes" class="screen">
            <h2 style="margin-bottom: 20px;">Who Likes You ❤️</h2>
            <div id="likesCounter" class="likes-counter">
                <span id="likesCount">0</span> people liked you
            </div>
            <div id="currentLikeProfile" class="current-like-container">
                <!-- Current person who liked you will be shown here -->
            </div>
            <div id="likesEmpty" class="empty-state">
                <div class="empty-state-icon">💕</div>
                <h3>No likes yet</h3>
                <p>Be patient! Someone special will like you soon.</p>
            </div>
        </div>

        <!-- Matches Screen -->
        <div id="matches" class="screen">
            <h2 style="margin-bottom: 20px;">Your Matches</h2>
            <div id="matchesList"></div>
            <div id="matchesEmpty" class="empty-state">
                <div class="empty-state-icon">💝</div>
                <h3>No matches yet</h3>
                <p>Start liking profiles to find your matches!</p>
            </div>
        </div>

        <!-- Profile Screen -->
        <div id="profile" class="screen">
            <h2 style="margin-bottom: 20px;">Your Profile</h2>
            <div id="profileStatus"></div>
            
            <form id="profileForm">
                <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" id="profileName" class="form-input" placeholder="Your name" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Age</label>
                    <input type="number" id="profileAge" class="form-input" placeholder="Your age" min="18" max="100" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Gender</label>
                    <select id="profileGender" class="form-input" required>
                        <option value="">Select your gender</option>
                        <option value="man">Man</option>
                        <option value="woman">Woman</option>
                        <option value="non-binary">Non-binary</option>
                        <option value="transgender">Transgender</option>
                        <option value="genderfluid">Genderfluid</option>
                        <option value="other">Other</option>
                        <option value="prefer-not-to-say">Prefer not to say</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Sexual Orientation</label>
                    <select id="profileSexuality" class="form-input" required>
                        <option value="">Select your orientation</option>
                        <option value="straight">Straight</option>
                        <option value="gay">Gay</option>
                        <option value="lesbian">Lesbian</option>
                        <option value="bisexual">Bisexual</option>
                        <option value="pansexual">Pansexual</option>
                        <option value="asexual">Asexual</option>
                        <option value="demisexual">Demisexual</option>
                        <option value="queer">Queer</option>
                        <option value="questioning">Questioning</option>
                        <option value="other">Other</option>
                        <option value="prefer-not-to-say">Prefer not to say</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Looking For</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="lookingForMen" class="form-checkbox">
                            <label for="lookingForMen" class="checkbox-label">Men</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="lookingForWomen" class="form-checkbox">
                            <label for="lookingForWomen" class="checkbox-label">Women</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="lookingForNonBinary" class="form-checkbox">
                            <label for="lookingForNonBinary" class="checkbox-label">Non-binary</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="lookingForEveryone" class="form-checkbox">
                            <label for="lookingForEveryone" class="checkbox-label">Everyone</label>
                        </div>
                    </div>
                    <div class="preference-note">Select who you'd like to see and be shown to</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Age Preference</label>
                    <div class="age-range-container">
                        <div class="age-range-header">
                            <span>Age range: </span>
                            <span id="ageRangeDisplay">18 - 35</span>
                        </div>
                        <div class="range-inputs">
                            <div class="range-group">
                                <label class="range-label">Min Age</label>
                                <input type="range" id="minAge" class="age-slider" min="18" max="80" value="18">
                                <span id="minAgeValue" class="range-value">18</span>
                            </div>
                            <div class="range-group">
                                <label class="range-label">Max Age</label>
                                <input type="range" id="maxAge" class="age-slider" min="18" max="80" value="35">
                                <span id="maxAgeValue" class="range-value">35</span>
                            </div>
                        </div>
                    </div>
                    <div class="preference-note">Choose the age range you're interested in dating</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <div style="position: relative;">
                        <input type="text" id="profileLocation" class="form-input" placeholder="Your city" required readonly>
                        <button type="button" id="locationBtn" class="location-btn" onclick="console.log('Location button clicked!'); openLocationPicker();">
                            📍 Set Location
                        </button>
                    </div>
                    <div id="locationStatus" class="location-status"></div>
                </div>
                
                <!-- Personal Prompts -->
                <div class="prompts-section">
                    <h3 class="prompts-title">Tell us about yourself <span style="color: #e91e63;">*</span></h3>
                    <p class="prompts-description">Answer these 3 questions to help others get to know you better!</p>
                    
                    <div class="form-group">
                        <label class="form-label">Personal Question <span style="color: #e91e63;">*</span></label>
                        <select id="personalPrompt" class="form-input" required onchange="updatePromptPlaceholder('personal')">
                            <option value="">Choose a question...</option>
                            <option value="My biggest dream is...">My biggest dream is...</option>
                            <option value="The best advice I've ever received is...">The best advice I've ever received is...</option>
                            <option value="Something I'm passionate about is...">Something I'm passionate about is...</option>
                            <option value="My biggest fear is...">My biggest fear is...</option>
                            <option value="If I could change one thing about the world...">If I could change one thing about the world...</option>
                            <option value="My proudest moment was...">My proudest moment was...</option>
                        </select>
                        <textarea id="personalAnswer" class="form-textarea prompt-answer" placeholder="Your answer..." required maxlength="150"></textarea>
                        <div class="char-counter"><span id="personalCount">0</span>/150</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Interest Question <span style="color: #e91e63;">*</span></label>
                        <select id="interestPrompt" class="form-input" required onchange="updatePromptPlaceholder('interest')">
                            <option value="">Choose a question...</option>
                            <option value="My favorite way to spend a weekend is...">My favorite way to spend a weekend is...</option>
                            <option value="The last book I couldn't put down was...">The last book I couldn't put down was...</option>
                            <option value="My go-to karaoke song is...">My go-to karaoke song is...</option>
                            <option value="The best meal I've ever had was...">The best meal I've ever had was...</option>
                            <option value="My guilty pleasure is...">My guilty pleasure is...</option>
                            <option value="I could talk for hours about...">I could talk for hours about...</option>
                        </select>
                        <textarea id="interestAnswer" class="form-textarea prompt-answer" placeholder="Your answer..." required maxlength="150"></textarea>
                        <div class="char-counter"><span id="interestCount">0</span>/150</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Hobby Question <span style="color: #e91e63;">*</span></label>
                        <select id="hobbyPrompt" class="form-input" required onchange="updatePromptPlaceholder('hobby')">
                            <option value="">Choose a question...</option>
                            <option value="A hobby I'd love to try is...">A hobby I'd love to try is...</option>
                            <option value="When I have free time, I love to...">When I have free time, I love to...</option>
                            <option value="The most adventurous thing I've done is...">The most adventurous thing I've done is...</option>
                            <option value="My hidden talent is...">My hidden talent is...</option>
                            <option value="If I could learn any skill instantly...">If I could learn any skill instantly...</option>
                            <option value="The activity that makes me lose track of time is...">The activity that makes me lose track of time is...</option>
                        </select>
                        <textarea id="hobbyAnswer" class="form-textarea prompt-answer" placeholder="Your answer..." required maxlength="150"></textarea>
                        <div class="char-counter"><span id="hobbyCount">0</span>/150</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Photos <span style="color: #e91e63;">*</span></label>
                    <div class="photo-requirements" id="photoRequirements">
                        Add 3-6 photos to show your personality! (3 minimum required)
                    </div>
                    <div class="photo-grid" id="photoGrid">
                        <div class="photo-slot" onclick="selectPhoto(0)">
                            <div class="photo-placeholder">
                                <div class="photo-number">1</div>
                                <div class="photo-text">Add Photo</div>
                            </div>
                        </div>
                        <div class="photo-slot" onclick="selectPhoto(1)">
                            <div class="photo-placeholder">
                                <div class="photo-number">2</div>
                                <div class="photo-text">Add Photo</div>
                            </div>
                        </div>
                        <div class="photo-slot" onclick="selectPhoto(2)">
                            <div class="photo-placeholder">
                                <div class="photo-number">3</div>
                                <div class="photo-text">Add Photo</div>
                            </div>
                        </div>
                        <div class="photo-slot" onclick="selectPhoto(3)">
                            <div class="photo-placeholder">
                                <div class="photo-number">4</div>
                                <div class="photo-text">Add Photo</div>
                            </div>
                        </div>
                        <div class="photo-slot" onclick="selectPhoto(4)">
                            <div class="photo-placeholder">
                                <div class="photo-number">5</div>
                                <div class="photo-text">Add Photo</div>
                            </div>
                        </div>
                        <div class="photo-slot" onclick="selectPhoto(5)">
                            <div class="photo-placeholder">
                                <div class="photo-number">6</div>
                                <div class="photo-text">Add Photo</div>
                            </div>
                        </div>
                    </div>
                    <input type="file" id="photoInput" class="hidden-file-input" accept="image/*" onchange="handlePhotoSelect(event)">
                </div>
                
                <button type="submit" class="btn">Save Profile</button>
                <button type="button" class="btn btn-secondary" onclick="logout()" style="margin-left: 10px;">Logout</button>
            </form>
        </div>

        <!-- Match Notification -->
        <div id="matchNotification" class="match-notification">
            <h2>🎉 It's a Match!</h2>
            <p>You and <span id="matchName"></span> liked each other!</p>
            <button class="btn" onclick="hideMatchNotification()" style="margin-top: 20px;">Continue</button>
        </div>

        <!-- Location Picker Modal -->
        <div id="mapModal" class="map-modal">
            <div class="map-container">
                <div class="map-header">
                    <h3>📍 Set Your Location</h3>
                    <button class="map-close" onclick="closeLocationPicker()">×</button>
                </div>
                
                <div class="map-controls-top">
                    <button class="map-btn secondary" onclick="getCurrentLocation()">
                        🎯 Use My Location
                    </button>
                    <button class="map-btn secondary" onclick="searchLocation()">
                        🔍 Search
                    </button>
                    <button class="map-btn secondary" onclick="useIPLocation()">
                        🌐 Detect Location
                    </button>
                </div>
                
                <div class="search-container" id="searchContainer" style="display: none;">
                    <input type="text" id="locationSearch" placeholder="Search for a city or address..." class="search-input">
                    <button onclick="performLocationSearch()" class="search-btn">Search</button>
                </div>
                
                <div class="map-display" id="mapDisplay">
                    <iframe 
                        id="mapFrame" 
                        width="100%" 
                        height="400" 
                        frameborder="0" 
                        style="border:0; border-radius: 8px;"
                        referrerpolicy="no-referrer-when-downgrade"
                        src="about:blank">
                    </iframe>
                    <div id="mapOverlay" class="map-overlay">
                        <div class="crosshair">+</div>
                        <div class="instruction-text">Move map to position crosshair, then click "Set Pin Here"</div>
                    </div>
                </div>
                
                <div class="coordinates" id="coordinates"></div>
                <div class="location-info" id="locationInfo"></div>
                
                <div class="map-controls">
                    <button class="map-btn secondary" onclick="closeLocationPicker()">Cancel</button>
                    <button class="map-btn" onclick="setPinAtCenter()" id="setPinBtn">📍 Set Pin Here</button>
                    <button class="map-btn primary" onclick="confirmLocation()" id="confirmLocationBtn" disabled>
                        Confirm Location
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Like Options Modal -->
        <div id="likeOptionsModal" class="message-modal">
            <div class="message-content">
                <div class="message-header">
                    <div class="message-title">❤️ Like <span id="likeRecipient"></span></div>
                    <div class="message-subtitle">Choose how you'd like to show your interest</div>
                </div>
                
                <div class="like-options">
                    <button class="like-option-btn" onclick="justLike()">
                        <div class="option-icon">❤️</div>
                        <div class="option-text">
                            <div class="option-title">Just Like</div>
                            <div class="option-subtitle">Send a simple like</div>
                        </div>
                    </button>
                    
                    <button class="like-option-btn" onclick="showMessageSection()">
                        <div class="option-icon">💬</div>
                        <div class="option-text">
                            <div class="option-title">Like with Message</div>
                            <div class="option-subtitle">Add a personal touch</div>
                        </div>
                    </button>
                </div>
                
                <div id="messageSection" class="message-section" style="display: none;">
                    <textarea 
                        id="messageText" 
                        class="message-textarea" 
                        placeholder="Write something nice... 😊"
                        maxlength="300"
                        oninput="updateCharacterCount()">
                    </textarea>
                    
                    <div style="text-align: right; font-size: 12px; color: #666; margin-bottom: 15px;">
                        <span id="charCount">0</span>/300 characters
                    </div>
                    
                    <div class="message-actions">
                        <button class="message-btn secondary" onclick="hideMessageSection()">Back</button>
                        <button class="message-btn primary" onclick="sendMessageAndLike()">Send & Like ❤️</button>
                    </div>
                </div>
                
                <div id="simpleActions" class="message-actions">
                    <button class="message-btn secondary" onclick="closeLikeOptions()">Cancel</button>
                </div>
            </div>
        </div>
        
        <!-- Chat Modal -->
        <div id="chatModal" class="message-modal">
            <div class="chat-container">
                <div class="chat-header">
                    <button class="chat-back-btn" onclick="closeChatModal()">←</button>
                    <div class="chat-user-info">
                        <div class="chat-avatar" id="chatAvatar">💕</div>
                        <div class="chat-user-details">
                            <div class="chat-user-name" id="chatUserName">User</div>
                            <div class="chat-status">Online</div>
                        </div>
                    </div>
                    <button class="chat-options-btn">⋮</button>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <div class="chat-welcome">
                        <div class="welcome-icon">🎉</div>
                        <div class="welcome-text">You matched with <span id="welcomeUserName">User</span>!</div>
                        <div class="welcome-subtext">Start a conversation</div>
                    </div>
                </div>
                
                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <input 
                            type="text" 
                            id="chatInput" 
                            class="chat-input" 
                            placeholder="Type a message..."
                            onkeypress="handleChatKeyPress(event)"
                            maxlength="500">
                        <button class="chat-send-btn" onclick="sendChatMessage()">
                            <span class="send-icon">➤</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // App State
        let currentUser = null;
        let userProfiles = [];
        let currentProfileIndex = 0;
        let userMatches = [];
        let userLikes = [];
        let likesQueue = []; // Queue of people who liked the current user
        let currentLikeIndex = 0; // Current position in the likes queue
        let userPhotos = []; // Store user's photos
        let currentPhotoSlot = 0; // Track which photo slot is being edited
        let currentChatUser = null; // Current chat partner
        let userChats = {}; // Store all chat conversations
        
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
        
        // Sample profiles data
        const sampleProfiles = [
            {
                id: 1,
                name: "Sarah",
                age: 24,
                gender: "woman",
                sexuality: "straight",
                location: "San Francisco",
                bio: "Love hiking, coffee, and good conversations. Looking for someone genuine!",
                interests: "Hiking, Photography, Yoga",
                emoji: "🌸"
            },
            {
                id: 2,
                name: "Alex",
                age: 27,
                gender: "man",
                sexuality: "straight",
                location: "New York",
                bio: "Software engineer by day, chef by night. Let's cook something amazing together!",
                interests: "Cooking, Tech, Travel",
                emoji: "👨‍💻"
            },
            {
                id: 3,
                name: "Maya",
                age: 25,
                gender: "woman",
                sexuality: "bisexual",
                location: "Los Angeles",
                bio: "Artist and dreamer. Life's too short for boring conversations.",
                interests: "Art, Music, Dancing",
                emoji: "🎨"
            },
            {
                id: 4,
                name: "David",
                age: 29,
                gender: "man",
                sexuality: "gay",
                location: "Chicago",
                bio: "Fitness enthusiast and dog lover. Looking for adventure partner!",
                interests: "Fitness, Dogs, Adventure",
                emoji: "🏃‍♂️"
            },
            {
                id: 5,
                name: "Emma",
                age: 23,
                gender: "woman",
                sexuality: "lesbian",
                location: "Boston",
                bio: "Book lover and coffee addict. Let's discuss our favorite novels!",
                interests: "Reading, Coffee, Writing",
                emoji: "📚"
            },
            {
                id: 6,
                name: "Jordan",
                age: 26,
                gender: "non-binary",
                sexuality: "pansexual",
                location: "Seattle",
                bio: "Musician and nature lover. Always up for hiking or jamming sessions!",
                interests: "Music, Hiking, Poetry",
                emoji: "🎸"
            },
            {
                id: 7,
                name: "Carlos",
                age: 28,
                gender: "man",
                sexuality: "bisexual",
                location: "Miami",
                bio: "Beach volleyball player and travel enthusiast. Life's an adventure!",
                interests: "Sports, Travel, Beach",
                emoji: "🏐"
            }
        ];
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            checkUserLogin();
        });
        
        function checkUserLogin() {
            // Get user from login demo
            const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            if (registeredUsers.length > 0) {
                const lastUser = registeredUsers[registeredUsers.length - 1];
                const userData = JSON.parse(localStorage.getItem(`user_${lastUser}`) || '{}');
                if (userData.firstName) {
                    currentUser = {
                        phone: lastUser,
                        name: `${userData.firstName} ${userData.lastName}`,
                        ...userData
                    };
                    initializeApp();
                } else {
                    redirectToLogin();
                }
            } else {
                redirectToLogin();
            }
        }
        
        function redirectToLogin() {
            window.location.href = 'login-demo.html';
        }
        
        function initializeApp() {
            loadUserData();
            loadProfiles();
            loadMatches();
            generateDemoLikes(); // Add demo likes for the user
            showCurrentProfile();
            populateProfileForm();
            
            // Show welcome message for new sessions
            setTimeout(() => {
                if (currentUser && currentUser.name) {
                    showWelcomeMessage();
                }
            }, 500);
        }
        
        function showWelcomeMessage() {
            const firstName = currentUser.name.split(' ')[0];
            const welcomeDiv = document.createElement('div');
            welcomeDiv.innerHTML = `
                <div style="
                    position: fixed; 
                    top: 20px; 
                    left: 50%; 
                    transform: translateX(-50%);
                    background: linear-gradient(135deg, #e91e63, #f06292);
                    color: white;
                    padding: 12px 24px;
                    border-radius: 25px;
                    z-index: 1000;
                    box-shadow: 0 4px 20px rgba(233, 30, 99, 0.3);
                    animation: slideDown 0.5s ease-out;
                ">
                    Welcome to Hinge, ${firstName}! 💕
                </div>
                <style>
                    @keyframes slideDown {
                        from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
                        to { transform: translateX(-50%) translateY(0); opacity: 1; }
                    }
                </style>
            `;
            
            document.body.appendChild(welcomeDiv);
            
            // Remove welcome message after 3 seconds
            setTimeout(() => {
                welcomeDiv.remove();
            }, 3000);
        }
        
        function loadUserData() {
            const savedProfile = localStorage.getItem(`dating_profile_${currentUser.phone}`);
            if (savedProfile) {
                const profile = JSON.parse(savedProfile);
                Object.assign(currentUser, profile);
            }
            
            userLikes = JSON.parse(localStorage.getItem(`user_likes_${currentUser.phone}`) || '[]');
            userMatches = JSON.parse(localStorage.getItem(`user_matches_${currentUser.phone}`) || '[]');
        }
        
        function generateDemoLikes() {
            // Check if demo likes already exist
            const existingLikes = JSON.parse(localStorage.getItem(`likes_queue_${currentUser.phone}`) || '[]');
            
            // Only generate demo likes if none exist
            if (existingLikes.length === 0) {
                const demoLikers = [
                    {
                        phone: 'demo_liker_1',
                        name: 'Alex',
                        age: 26,
                        location: 'Downtown',
                        gender: 'Woman',
                        lookingFor: 'serious relationship',
                        likedAt: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString() // 2 hours ago
                    },
                    {
                        phone: 'demo_liker_2',
                        name: 'Jamie',
                        age: 24,
                        location: 'Uptown',
                        gender: 'Non-binary',
                        lookingFor: 'casual dating',
                        likedAt: new Date(Date.now() - 4 * 60 * 60 * 1000).toISOString() // 4 hours ago
                    },
                    {
                        phone: 'demo_liker_3',
                        name: 'Morgan',
                        age: 28,
                        location: 'Midtown',
                        gender: 'Man',
                        lookingFor: 'something real',
                        likedAt: new Date(Date.now() - 6 * 60 * 60 * 1000).toISOString() // 6 hours ago
                    }
                ];
                
                localStorage.setItem(`likes_queue_${currentUser.phone}`, JSON.stringify(demoLikers));
            }
        }
        
        function loadProfiles() {
            // Filter out already liked profiles and current user
            userProfiles = sampleProfiles.filter(profile => 
                !userLikes.includes(profile.id) && profile.id !== currentUser.id
            );
            currentProfileIndex = 0;
        }
        
        // Check if user profile is complete
        function isProfileComplete() {
            if (!currentUser.name || !currentUser.age || !currentUser.gender || 
                !currentUser.sexuality || !currentUser.location) {
                return false;
            }
            
            // Check if looking for preferences are set
            if (!currentUser.lookingFor || 
                (!currentUser.lookingFor.men && !currentUser.lookingFor.women && 
                 !currentUser.lookingFor.nonBinary && !currentUser.lookingFor.everyone)) {
                return false;
            }
            
            // Check if age preferences are set
            if (!currentUser.agePreference || !currentUser.agePreference.min || !currentUser.agePreference.max) {
                return false;
            }
            
            // Check if at least 3 photos are uploaded
            const photoCount = (currentUser.photos || []).filter(photo => photo && photo.trim() !== '').length;
            if (photoCount < 3) {
                return false;
            }
            
            // Check if all 3 prompts are answered
            if (!currentUser.prompts || 
                !currentUser.prompts.personal || !currentUser.prompts.personal.question || !currentUser.prompts.personal.answer ||
                !currentUser.prompts.interest || !currentUser.prompts.interest.question || !currentUser.prompts.interest.answer ||
                !currentUser.prompts.hobby || !currentUser.prompts.hobby.question || !currentUser.prompts.hobby.answer) {
                return false;
            }
            
            return true;
        }
        
        function showCurrentProfile() {
            const stackElement = document.getElementById('profileStack');
            const emptyElement = document.getElementById('discoverEmpty');
            
            if (currentProfileIndex >= userProfiles.length) {
                stackElement.innerHTML = '';
                emptyElement.style.display = 'block';
                return;
            }
            
            emptyElement.style.display = 'none';
            const profile = userProfiles[currentProfileIndex];
            const isComplete = isProfileComplete();
            
            if (!isComplete) {
                // Show blurred profile with completion overlay
                stackElement.innerHTML = `
                    <div class="profile-card blurred" id="currentCard">
                        <div class="profile-image">
                            ${profile.emoji}
                        </div>
                        <div class="profile-info">
                            <div class="profile-name">${profile.name}, ${profile.age}</div>
                            <div class="profile-details">📍 ${profile.location}</div>
                        </div>
                        <div class="profile-completion-overlay">
                            <div class="completion-icon">🔒</div>
                            <div class="completion-title">Complete Your Profile First</div>
                            <div class="completion-message">
                                Finish setting up your profile to start discovering amazing people!
                            </div>
                            <button class="complete-profile-btn" onclick="showScreen('profile')">
                                Complete Profile
                            </button>
                        </div>
                    </div>
                `;
            } else {
                // Show normal profile
                stackElement.innerHTML = `
                    <div class="profile-card" id="currentCard">
                        <div class="profile-image">
                            ${profile.emoji}
                        </div>
                        <div class="profile-info">
                            <div class="profile-name">${profile.name}, ${profile.age}</div>
                            <div class="profile-details">📍 ${profile.location}</div>
                            
                            ${profile.prompts ? `
                                <div class="profile-prompts">
                                    <div class="prompt-item">
                                        <div class="prompt-question">${profile.prompts.personal.question}</div>
                                        <div class="prompt-answer">${profile.prompts.personal.answer}</div>
                                    </div>
                                    <div class="prompt-item">
                                        <div class="prompt-question">${profile.prompts.interest.question}</div>
                                        <div class="prompt-answer">${profile.prompts.interest.answer}</div>
                                    </div>
                                    <div class="prompt-item">
                                        <div class="prompt-question">${profile.prompts.hobby.question}</div>
                                        <div class="prompt-answer">${profile.prompts.hobby.answer}</div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        <div class="action-buttons">
                            <button class="action-btn pass-btn" onclick="passProfile()">✖️</button>
                            <button class="action-btn like-btn" onclick="showLikeOptions()">❤️</button>
                        </div>
                    </div>
                `;
            }
        }
        
        function passProfile() {
            animateCard('left');
            setTimeout(() => {
                currentProfileIndex++;
                showCurrentProfile();
            }, 300);
        }
        
        function likeProfile() {
            const profile = userProfiles[currentProfileIndex];
            userLikes.push(profile.id);
            localStorage.setItem(`user_likes_${currentUser.phone}`, JSON.stringify(userLikes));
            
            // Add current user to the liked profile's likes queue
            addToLikesQueue(profile.id, currentUser);
            
            // Check if it's a match (simulate random matching for demo)
            const isMatch = Math.random() > 0.6; // 40% chance of match
            
            if (isMatch) {
                userMatches.push(profile);
                localStorage.setItem(`user_matches_${currentUser.phone}`, JSON.stringify(userMatches));
                showMatchNotification(profile.name);
                loadMatches();
            }
            
            animateCard('right');
            setTimeout(() => {
                currentProfileIndex++;
                showCurrentProfile();
            }, 300);
        }
        
        function showLikeOptions() {
            const profile = userProfiles[currentProfileIndex];
            document.getElementById('likeRecipient').textContent = profile.name;
            document.getElementById('messageText').value = '';
            document.getElementById('charCount').textContent = '0';
            document.getElementById('messageSection').style.display = 'none';
            document.getElementById('simpleActions').style.display = 'flex';
            document.getElementById('likeOptionsModal').classList.add('show');
        }
        
        function closeLikeOptions() {
            document.getElementById('likeOptionsModal').classList.remove('show');
        }
        
        function justLike() {
            closeLikeOptions();
            likeProfile();
        }
        
        function showMessageSection() {
            document.getElementById('messageSection').style.display = 'block';
            document.getElementById('simpleActions').style.display = 'none';
            document.getElementById('messageText').focus();
        }
        
        function hideMessageSection() {
            document.getElementById('messageSection').style.display = 'none';
            document.getElementById('simpleActions').style.display = 'flex';
            document.getElementById('messageText').value = '';
            document.getElementById('charCount').textContent = '0';
        }
        
        function openMessageModal() {
            const profile = userProfiles[currentProfileIndex];
            document.getElementById('messageRecipient').textContent = profile.name;
            document.getElementById('messageText').value = '';
            document.getElementById('messageModal').classList.add('show');
        }
        
        function closeMessageModal() {
            document.getElementById('messageModal').classList.remove('show');
        }
        
        function sendMessageAndLike() {
            const messageText = document.getElementById('messageText').value.trim();
            const profile = userProfiles[currentProfileIndex];
            
            if (messageText.length === 0) {
                alert('Please write a message first!');
                return;
            }
            
            // Save the message with the like
            const messageData = {
                profileId: profile.id,
                message: messageText,
                timestamp: new Date().toISOString(),
                from: currentUser.name || 'Anonymous'
            };
            
            // Store messages (you can extend this to a proper messaging system)
            let userMessages = JSON.parse(localStorage.getItem(`user_messages_${currentUser.phone}`) || '[]');
            userMessages.push(messageData);
            localStorage.setItem(`user_messages_${currentUser.phone}`, JSON.stringify(userMessages));
            
            // Add like
            userLikes.push(profile.id);
            localStorage.setItem(`user_likes_${currentUser.phone}`, JSON.stringify(userLikes));
            
            // Check for match
            const isMatch = Math.random() > 0.6; // 40% chance of match
            
            if (isMatch) {
                userMatches.push(profile);
                localStorage.setItem(`user_matches_${currentUser.phone}`, JSON.stringify(userMatches));
                showMatchNotification(profile.name);
                loadMatches();
            }
            
            closeLikeOptions();
            animateCard('right');
            setTimeout(() => {
                currentProfileIndex++;
                showCurrentProfile();
            }, 300);
        }
        
        function updateCharacterCount() {
            const textarea = document.getElementById('messageText');
            const charCount = document.getElementById('charCount');
            charCount.textContent = textarea.value.length;
        }
        
        // Photo handling functions
        function selectPhoto(slotIndex) {
            currentPhotoSlot = slotIndex;
            document.getElementById('photoInput').click();
        }
        
        function handlePhotoSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file');
                return;
            }
            
            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('Image size must be less than 5MB');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                userPhotos[currentPhotoSlot] = e.target.result;
                updatePhotoDisplay();
                validatePhotos();
            };
            reader.readAsDataURL(file);
        }
        
        function updatePhotoDisplay() {
            const photoGrid = document.getElementById('photoGrid');
            const slots = photoGrid.children;
            
            for (let i = 0; i < slots.length; i++) {
                const slot = slots[i];
                if (userPhotos[i]) {
                    slot.className = 'photo-slot filled';
                    slot.innerHTML = `
                        <img src="${userPhotos[i]}" alt="Photo ${i + 1}">
                        <button class="remove-photo" onclick="removePhoto(${i})">×</button>
                    `;
                } else {
                    slot.className = 'photo-slot';
                    slot.innerHTML = `
                        <div class="photo-placeholder">
                            <div class="photo-number">${i + 1}</div>
                            <div class="photo-text">Add Photo</div>
                        </div>
                    `;
                }
            }
        }
        
        function removePhoto(slotIndex) {
            userPhotos[slotIndex] = null;
            updatePhotoDisplay();
            validatePhotos();
        }
        
        function validatePhotos() {
            const filledPhotos = userPhotos.filter(photo => photo !== null && photo !== undefined).length;
            const requirements = document.getElementById('photoRequirements');
            
            if (filledPhotos < 3) {
                requirements.textContent = `Add ${3 - filledPhotos} more photos (minimum 3 required)`;
                requirements.className = 'photo-requirements error';
                return false;
            } else {
                requirements.textContent = `Great! You have ${filledPhotos} photos. You can add up to ${6 - filledPhotos} more.`;
                requirements.className = 'photo-requirements';
                return true;
            }
        }
        
        function getPhotoCount() {
            return userPhotos.filter(photo => photo !== null && photo !== undefined).length;
        }
        
        function animateCard(direction) {
            const card = document.getElementById('currentCard');
            if (card) {
                card.classList.add(direction === 'left' ? 'card-exit-left' : 'card-exit-right');
            }
        }
        
        function showMatchNotification(name) {
            document.getElementById('matchName').textContent = name;
            document.getElementById('matchNotification').classList.add('show');
        }
        
        function hideMatchNotification() {
            document.getElementById('matchNotification').classList.remove('show');
        }
        
        function loadMatches() {
            const matchesList = document.getElementById('matchesList');
            const emptyState = document.getElementById('matchesEmpty');
            
            if (userMatches.length === 0) {
                matchesList.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            matchesList.innerHTML = userMatches.map(match => {
                // Get last message for preview from chat
                const chatKey = `chat_${currentUser.phone}_${match.id}`;
                const chatMessages = JSON.parse(localStorage.getItem(chatKey) || '[]');
                const lastChatMessage = chatMessages.length > 0 ? chatMessages[chatMessages.length - 1] : null;
                
                // Get initial message from user_messages (sent with like)
                const userMessages = JSON.parse(localStorage.getItem(`user_messages_${currentUser.phone}`) || '[]');
                const messageForMatch = userMessages.find(msg => msg.profileId === match.id);
                
                let previewText = 'Say hello to start chatting!';
                let messageTime = '';
                
                if (lastChatMessage) {
                    // Show last chat message
                    previewText = lastChatMessage.text.length > 50 ? lastChatMessage.text.substring(0, 50) + '...' : lastChatMessage.text;
                    const messageDate = new Date(lastChatMessage.timestamp);
                    const now = new Date();
                    const diffHours = Math.abs(now - messageDate) / 36e5;
                    
                    if (diffHours < 24) {
                        messageTime = messageDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    } else {
                        messageTime = messageDate.toLocaleDateString();
                    }
                } else if (messageForMatch) {
                    // Show initial message sent with like
                    previewText = `💬 "${messageForMatch.message.substring(0, 50)}${messageForMatch.message.length > 50 ? '...' : ''}"`;
                }
                
                return `
                    <div class="match-card" onclick="openChat('${match.name}')">
                        <div class="match-avatar">${match.emoji}</div>
                        <div class="match-info">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                <h3 style="margin: 0;">${match.name}</h3>
                                ${messageTime ? `<span style="font-size: 12px; color: #666;">${messageTime}</span>` : ''}
                            </div>
                            <p style="margin: 0; color: #666; font-size: 14px;">${previewText}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function openChat(name) {
            console.log('openChat called for:', name); // Debug log
            const matchedUser = userMatches.find(match => match.name === name);
            if (!matchedUser) {
                console.log('No matched user found for:', name);
                return;
            }
            
            currentChatUser = matchedUser;
            document.getElementById('chatUserName').textContent = name;
            document.getElementById('welcomeUserName').textContent = name;
            document.getElementById('chatAvatar').textContent = matchedUser.emoji || '💕';
            
            // Load existing chat messages
            loadChatMessages(matchedUser.id);
            
            // Show chat modal
            document.getElementById('chatModal').classList.add('show');
            
            // Focus on input
            setTimeout(() => {
                document.getElementById('chatInput').focus();
            }, 300);
        }
        
        function closeChatModal() {
            document.getElementById('chatModal').classList.remove('show');
            currentChatUser = null;
        }
        
        function loadChatMessages(userId) {
            const chatKey = `chat_${currentUser.phone}_${userId}`;
            const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            
            const messagesContainer = document.getElementById('chatMessages');
            const welcomeElement = messagesContainer.querySelector('.chat-welcome');
            
            if (messages.length === 0) {
                welcomeElement.style.display = 'block';
                return;
            }
            
            welcomeElement.style.display = 'none';
            
            // Clear existing messages (except welcome)
            const existingMessages = messagesContainer.querySelectorAll('.chat-message');
            existingMessages.forEach(msg => msg.remove());
            
            // Add messages
            messages.forEach(message => {
                addMessageToChat(message.text, message.sender === currentUser.phone, message.timestamp);
            });
            
            // Scroll to bottom
            scrollChatToBottom();
        }
        
        function addMessageToChat(text, isSent, timestamp = null) {
            const messagesContainer = document.getElementById('chatMessages');
            const welcomeElement = messagesContainer.querySelector('.chat-welcome');
            welcomeElement.style.display = 'none';
            
            const messageElement = document.createElement('div');
            messageElement.className = `chat-message ${isSent ? 'sent' : 'received'}`;
            
            const timeStr = timestamp ? new Date(timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            messageElement.innerHTML = `
                <div class="message-bubble">
                    ${text}
                    <div class="message-time">${timeStr}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageElement);
            scrollChatToBottom();
        }
        
        function scrollChatToBottom() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }
        
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const messageText = input.value.trim();
            
            if (!messageText || !currentChatUser) return;
            
            // Add message to chat
            addMessageToChat(messageText, true);
            
            // Save message to localStorage
            const chatKey = `chat_${currentUser.phone}_${currentChatUser.id}`;
            const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            
            const newMessage = {
                text: messageText,
                sender: currentUser.phone,
                recipient: currentChatUser.id,
                timestamp: new Date().toISOString()
            };
            
            messages.push(newMessage);
            localStorage.setItem(chatKey, JSON.stringify(messages));
            
            // Clear input
            input.value = '';
            
            // Simulate response after a delay
            setTimeout(() => {
                simulateResponse();
            }, 1000 + Math.random() * 2000);
        }
        
        function simulateResponse() {
            if (!currentChatUser) return;
            
            const responses = [
                "Hey! Thanks for the message �",
                "I'm glad we matched!",
                "Tell me more about yourself",
                "What do you like to do for fun?",
                "You seem really interesting!",
                "I'd love to chat more",
                "How's your day going?",
                "That's awesome! 🎉",
                "I really like your profile",
                "Want to get to know each other better?"
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            // Show typing indicator
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                addMessageToChat(randomResponse, false);
                
                // Save simulated response
                const chatKey = `chat_${currentUser.phone}_${currentChatUser.id}`;
                const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');
                
                const responseMessage = {
                    text: randomResponse,
                    sender: currentChatUser.id,
                    recipient: currentUser.phone,
                    timestamp: new Date().toISOString()
                };
                
                messages.push(responseMessage);
                localStorage.setItem(chatKey, JSON.stringify(messages));
            }, 1500);
        }
        
        function showTypingIndicator() {
            const messagesContainer = document.getElementById('chatMessages');
            
            const typingElement = document.createElement('div');
            typingElement.className = 'chat-message received';
            typingElement.id = 'typingIndicator';
            
            typingElement.innerHTML = `
                <div class="typing-indicator">
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(typingElement);
            scrollChatToBottom();
        }
        
        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }
        
        function populateProfileForm() {
            if (currentUser.name) {
                document.getElementById('profileName').value = currentUser.name;
            }
            if (currentUser.age) {
                document.getElementById('profileAge').value = currentUser.age;
            }
            if (currentUser.gender) {
                document.getElementById('profileGender').value = currentUser.gender;
            }
            if (currentUser.sexuality) {
                document.getElementById('profileSexuality').value = currentUser.sexuality;
            }
            if (currentUser.lookingFor) {
                // Load looking for preferences
                if (currentUser.lookingFor.men) document.getElementById('lookingForMen').checked = true;
                if (currentUser.lookingFor.women) document.getElementById('lookingForWomen').checked = true;
                if (currentUser.lookingFor.nonBinary) document.getElementById('lookingForNonBinary').checked = true;
                if (currentUser.lookingFor.everyone) document.getElementById('lookingForEveryone').checked = true;
            }
            if (currentUser.agePreference) {
                document.getElementById('minAge').value = currentUser.agePreference.min || 18;
                document.getElementById('maxAge').value = currentUser.agePreference.max || 35;
                updateAgeDisplay();
            }
            if (currentUser.location) {
                document.getElementById('profileLocation').value = currentUser.location;
            }
            
            // Load saved prompts
            if (currentUser.prompts) {
                if (currentUser.prompts.personal) {
                    document.getElementById('personalPrompt').value = currentUser.prompts.personal.question;
                    document.getElementById('personalAnswer').value = currentUser.prompts.personal.answer;
                    updatePromptPlaceholder('personal');
                }
                if (currentUser.prompts.interest) {
                    document.getElementById('interestPrompt').value = currentUser.prompts.interest.question;
                    document.getElementById('interestAnswer').value = currentUser.prompts.interest.answer;
                    updatePromptPlaceholder('interest');
                }
                if (currentUser.prompts.hobby) {
                    document.getElementById('hobbyPrompt').value = currentUser.prompts.hobby.question;
                    document.getElementById('hobbyAnswer').value = currentUser.prompts.hobby.answer;
                    updatePromptPlaceholder('hobby');
                }
            }
            
            // Load saved photos
            if (currentUser.photos && currentUser.photos.length > 0) {
                userPhotos = [...currentUser.photos];
                // Ensure userPhotos array has 6 slots
                while (userPhotos.length < 6) {
                    userPhotos.push(null);
                }
                updatePhotoDisplay();
                validatePhotos();
            } else {
                // Initialize empty photo array
                userPhotos = [null, null, null, null, null, null];
                updatePhotoDisplay();
                validatePhotos();
            }
            
            // Load saved coordinates if available
            if (currentUser.coordinates) {
                showLocationStatus(`Saved location: ${currentUser.location}`, 'success');
            }
        }
        
        document.getElementById('profileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validate photos first
            if (!validatePhotos() || getPhotoCount() < 3) {
                document.getElementById('profileStatus').innerHTML = `
                    <div class="status-message status-error">Please add at least 3 photos before saving your profile.</div>
                `;
                setTimeout(() => {
                    document.getElementById('profileStatus').innerHTML = '';
                }, 3000);
                return;
            }
            
            // Validate looking for preferences
            const lookingForChecked = [
                document.getElementById('lookingForMen').checked,
                document.getElementById('lookingForWomen').checked,
                document.getElementById('lookingForNonBinary').checked,
                document.getElementById('lookingForEveryone').checked
            ].some(checked => checked);
            
            if (!lookingForChecked) {
                document.getElementById('profileStatus').innerHTML = `
                    <div class="status-message status-error">Please select at least one preference for who you're looking to date.</div>
                `;
                setTimeout(() => {
                    document.getElementById('profileStatus').innerHTML = '';
                }, 3000);
                return;
            }
            
            // Validate prompts
            const personalPrompt = document.getElementById('personalPrompt').value;
            const personalAnswer = document.getElementById('personalAnswer').value.trim();
            const interestPrompt = document.getElementById('interestPrompt').value;
            const interestAnswer = document.getElementById('interestAnswer').value.trim();
            const hobbyPrompt = document.getElementById('hobbyPrompt').value;
            const hobbyAnswer = document.getElementById('hobbyAnswer').value.trim();
            
            if (!personalPrompt || !personalAnswer || !interestPrompt || !interestAnswer || !hobbyPrompt || !hobbyAnswer) {
                document.getElementById('profileStatus').innerHTML = `
                    <div class="status-message status-error">Please complete all 3 personal prompts before saving your profile.</div>
                `;
                setTimeout(() => {
                    document.getElementById('profileStatus').innerHTML = '';
                }, 3000);
                return;
            }
            
            const profileData = {
                name: document.getElementById('profileName').value,
                age: parseInt(document.getElementById('profileAge').value),
                gender: document.getElementById('profileGender').value,
                sexuality: document.getElementById('profileSexuality').value,
                lookingFor: {
                    men: document.getElementById('lookingForMen').checked,
                    women: document.getElementById('lookingForWomen').checked,
                    nonBinary: document.getElementById('lookingForNonBinary').checked,
                    everyone: document.getElementById('lookingForEveryone').checked
                },
                agePreference: {
                    min: parseInt(document.getElementById('minAge').value),
                    max: parseInt(document.getElementById('maxAge').value)
                },
                location: document.getElementById('profileLocation').value,
                prompts: {
                    personal: {
                        question: personalPrompt,
                        answer: personalAnswer
                    },
                    interest: {
                        question: interestPrompt,
                        answer: interestAnswer
                    },
                    hobby: {
                        question: hobbyPrompt,
                        answer: hobbyAnswer
                    }
                },
                photos: userPhotos.filter(photo => photo !== null && photo !== undefined) // Save only filled photos
            };
            
            // Include coordinates if available
            if (currentUser.coordinates) {
                profileData.coordinates = currentUser.coordinates;
            }
            
            Object.assign(currentUser, profileData);
            localStorage.setItem(`dating_profile_${currentUser.phone}`, JSON.stringify(profileData));
            
            document.getElementById('profileStatus').innerHTML = `
                <div class="status-message status-success">Profile saved successfully! You can now discover other users.</div>
            `;
            
            // Refresh discover screen to remove blur if profile is now complete
            if (isProfileComplete()) {
                showCurrentProfile(); // Refresh current profile display
            }
            
            setTimeout(() => {
                document.getElementById('profileStatus').innerHTML = '';
            }, 3000);
        });
        
        function showScreen(screenName) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected screen
            document.getElementById(screenName).classList.add('active');
            document.getElementById(screenName + 'Btn').classList.add('active');
            
            // Refresh data when switching screens
            if (screenName === 'discover') {
                loadProfiles();
                showCurrentProfile();
            } else if (screenName === 'likes') {
                loadLikesScreen();
            } else if (screenName === 'matches') {
                loadMatches();
            }
        }
        
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear user data but keep it for re-login
                window.location.href = 'login-demo.html';
            }
        }
        
        // Likes Queue Functions
        function addToLikesQueue(profileId, likerUser) {
            // Get the existing likes queue for the profile
            const existingQueue = JSON.parse(localStorage.getItem(`likes_queue_${profileId}`) || '[]');
            
            // Check if this user already liked this profile
            const alreadyLiked = existingQueue.find(like => like.phone === likerUser.phone);
            if (!alreadyLiked) {
                existingQueue.push({
                    ...likerUser,
                    likedAt: new Date().toISOString()
                });
                localStorage.setItem(`likes_queue_${profileId}`, JSON.stringify(existingQueue));
            }
        }
        
        function loadLikesScreen() {
            if (!currentUser) return;
            
            // Load likes queue for current user
            likesQueue = JSON.parse(localStorage.getItem(`likes_queue_${currentUser.phone}`) || '[]');
            
            const likesCount = document.getElementById('likesCount');
            const likesEmpty = document.getElementById('likesEmpty');
            const currentLikeProfile = document.getElementById('currentLikeProfile');
            const likesCounter = document.getElementById('likesCounter');
            
            // Update likes counter
            likesCount.textContent = likesQueue.length;
            
            if (likesQueue.length === 0) {
                likesEmpty.style.display = 'block';
                currentLikeProfile.style.display = 'none';
                likesCounter.style.display = 'block';
            } else {
                likesEmpty.style.display = 'none';
                currentLikeProfile.style.display = 'block';
                likesCounter.style.display = 'block';
                currentLikeIndex = 0;
                showCurrentLike();
            }
        }
        
        function showCurrentLike() {
            if (!likesQueue || likesQueue.length === 0 || currentLikeIndex >= likesQueue.length) {
                loadLikesScreen(); // Refresh if no more likes
                return;
            }
            
            const liker = likesQueue[currentLikeIndex];
            const currentLikeProfile = document.getElementById('currentLikeProfile');
            
            // Generate random photos for the liker
            const photos = [
                `https://picsum.photos/400/600?random=${liker.phone}&sig=1`,
                `https://picsum.photos/400/600?random=${liker.phone}&sig=2`,
                `https://picsum.photos/400/600?random=${liker.phone}&sig=3`
            ];
            
            currentLikeProfile.innerHTML = `
                <div class="likes-queue-info">
                    <h3>Someone likes you! 💕</h3>
                    <p>Decide on this person to see the next one</p>
                </div>
                
                <div class="like-profile-card">
                    <div class="like-badge">Liked You ❤️</div>
                    
                    <div class="profile-photos">
                        <div class="photo-container">
                            <img src="${photos[0]}" alt="${liker.name}" class="photo active">
                            <img src="${photos[1]}" alt="${liker.name}" class="photo">
                            <img src="${photos[2]}" alt="${liker.name}" class="photo">
                        </div>
                        <div class="photo-indicators">
                            <span class="indicator active"></span>
                            <span class="indicator"></span>
                            <span class="indicator"></span>
                        </div>
                    </div>
                    
                    <div class="profile-info">
                        <h2>${liker.name || 'Anonymous'}, ${liker.age || '25'}</h2>
                        <p class="location">📍 ${liker.location || 'Nearby'}</p>
                        
                        <div class="profile-details">
                            <div class="detail-item">
                                <span class="detail-icon">👤</span>
                                <span>${liker.gender || 'Prefers not to say'}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-icon">💕</span>
                                <span>Looking for ${liker.lookingFor || 'connection'}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="like-actions">
                        <button class="like-action-btn like-pass-btn" onclick="passOnLike()">
                            ❌
                        </button>
                        <button class="like-action-btn like-match-btn" onclick="matchWithLike()">
                            ❤️
                        </button>
                    </div>
                </div>
            `;
            
            // Add photo navigation
            addPhotoNavigation();
        }
        
        function passOnLike() {
            // Remove current like from queue
            likesQueue.splice(currentLikeIndex, 1);
            localStorage.setItem(`likes_queue_${currentUser.phone}`, JSON.stringify(likesQueue));
            
            // Show next like or refresh screen
            showCurrentLike();
            
            // Update counter
            document.getElementById('likesCount').textContent = likesQueue.length;
        }
        
        function matchWithLike() {
            const liker = likesQueue[currentLikeIndex];
            
            // Add to matches
            userMatches.push({
                id: liker.phone,
                name: liker.name || 'Anonymous',
                age: liker.age || 25,
                photos: [
                    `https://picsum.photos/400/600?random=${liker.phone}&sig=1`,
                    `https://picsum.photos/400/600?random=${liker.phone}&sig=2`,
                    `https://picsum.photos/400/600?random=${liker.phone}&sig=3`
                ],
                location: liker.location || 'Nearby',
                gender: liker.gender || 'Prefers not to say',
                lookingFor: liker.lookingFor || 'connection'
            });
            
            localStorage.setItem(`user_matches_${currentUser.phone}`, JSON.stringify(userMatches));
            
            // Remove from likes queue
            likesQueue.splice(currentLikeIndex, 1);
            localStorage.setItem(`likes_queue_${currentUser.phone}`, JSON.stringify(likesQueue));
            
            // Show match notification
            showMatchNotification(liker.name || 'Someone special');
            
            // Show next like or refresh screen
            showCurrentLike();
            
            // Update counter
            document.getElementById('likesCount').textContent = likesQueue.length;
            
            // Update matches screen
            loadMatches();
        }
        
        // Location Picker Functions
        let selectedLocation = null;
        let userCoordinates = null;
        let currentMapCenter = { lat: 40.7128, lng: -74.0060 }; // Default to NYC
        
        function openLocationPicker() {
            console.log('Opening location picker...');
            const mapModal = document.getElementById('mapModal');
            console.log('Map modal element:', mapModal);
            if (mapModal) {
                console.log('Current modal classes:', mapModal.className);
                console.log('Current modal style display:', mapModal.style.display);
                
                // Force show the modal with multiple methods
                mapModal.classList.add('show');
                mapModal.style.display = 'flex';
                mapModal.style.visibility = 'visible';
                
                console.log('After adding show class:', mapModal.className);
                console.log('After setting display flex:', mapModal.style.display);
                
                // Initialize map
                initializeMap();
            } else {
                console.error('Map modal not found!');
            }
            resetMapPin();
        }
        
        function initializeMap() {
            // Use OpenStreetMap with a simple iframe approach
            const mapFrame = document.getElementById('mapFrame');
            const lat = currentMapCenter.lat;
            const lng = currentMapCenter.lng;
            const zoom = 10;
            
            // Use OpenStreetMap iframe
            mapFrame.src = `https://www.openstreetmap.org/export/embed.html?bbox=${lng-0.1},${lat-0.1},${lng+0.1},${lat+0.1}&layer=mapnik&marker=${lat},${lng}`;
            
            updateCoordinatesDisplay(lat, lng);
        }
        
        function closeLocationPicker() {
            document.getElementById('mapModal').classList.remove('show');
            resetMapPin();
        }
        
        function resetMapPin() {
            const coordinates = document.getElementById('coordinates');
            const confirmBtn = document.getElementById('confirmLocationBtn');
            const locationInfo = document.getElementById('locationInfo');
            
            coordinates.textContent = '';
            locationInfo.textContent = '';
            confirmBtn.disabled = true;
            selectedLocation = null;
        }
        
        function getCurrentLocation() {
            const coordinates = document.getElementById('coordinates');
            const locationInfo = document.getElementById('locationInfo');
            
            console.log('getCurrentLocation called');
            console.log('Protocol:', window.location.protocol);
            console.log('Host:', window.location.host);
            
            // Check if HTTPS is available for geolocation
            if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
                coordinates.textContent = '⚠️ HTTPS required for GPS';
                locationInfo.textContent = 'Try "Detect Location" or search manually';
                return;
            }
            
            if (!navigator.geolocation) {
                console.error('Geolocation not supported');
                coordinates.textContent = 'GPS not supported';
                locationInfo.textContent = 'Please search for your location manually';
                return;
            }
            
            coordinates.textContent = '🔄 Getting your location...';
            locationInfo.textContent = 'Please allow location access when prompted';
            
            const options = {
                enableHighAccuracy: true,
                timeout: 15000,
                maximumAge: 300000 // 5 minutes
            };
            
            console.log('Requesting geolocation...');
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    console.log('Geolocation success:', position);
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    console.log('Coordinates:', lat, lng);
                    
                    currentMapCenter = { lat, lng };
                    userCoordinates = { lat, lng };
                    
                    // Update map to user's location with higher zoom
                    const mapFrame = document.getElementById('mapFrame');
                    const bbox = 0.005; // Smaller bbox for higher zoom
                    mapFrame.src = `https://www.openstreetmap.org/export/embed.html?bbox=${lng-bbox},${lat-bbox},${lng+bbox},${lat+bbox}&layer=mapnik&marker=${lat},${lng}`;
                    
                    updateCoordinatesDisplay(lat, lng);
                    locationInfo.textContent = '✅ Your current location found';
                    
                    // Enable the confirm button
                    document.getElementById('confirmLocationBtn').disabled = false;
                    selectedLocation = { lat, lng, isCurrentLocation: true };
                    
                    console.log('Location set successfully');
                },
                function(error) {
                    console.error('Geolocation error:', error);
                    let errorMessage = 'Unable to get location';
                    let helpText = 'Please try searching manually';
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = '❌ Location access denied';
                            helpText = 'Please enable location access in your browser settings';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = '❌ Location unavailable';
                            helpText = 'GPS signal not available. Try searching manually.';
                            break;
                        case error.TIMEOUT:
                            errorMessage = '❌ Location request timed out';
                            helpText = 'Please try again or search manually';
                            break;
                    }
                    
                    coordinates.textContent = errorMessage;
                    locationInfo.textContent = helpText;
                },
                options
            );
        }
        
        function useIPLocation() {
            const coordinates = document.getElementById('coordinates');
            const locationInfo = document.getElementById('locationInfo');
            
            coordinates.textContent = '🔄 Detecting location...';
            locationInfo.textContent = 'Using IP-based location detection';
            
            // Use ipapi.co for IP-based geolocation (free service)
            fetch('https://ipapi.co/json/')
                .then(response => response.json())
                .then(data => {
                    console.log('IP location data:', data);
                    
                    if (data.latitude && data.longitude) {
                        const lat = parseFloat(data.latitude);
                        const lng = parseFloat(data.longitude);
                        
                        currentMapCenter = { lat, lng };
                        
                        // Update map to detected location
                        const mapFrame = document.getElementById('mapFrame');
                        const bbox = 0.1; // Wider area for city-level detection
                        mapFrame.src = `https://www.openstreetmap.org/export/embed.html?bbox=${lng-bbox},${lat-bbox},${lng+bbox},${lat+bbox}&layer=mapnik&marker=${lat},${lng}`;
                        
                        updateCoordinatesDisplay(lat, lng);
                        locationInfo.textContent = `📍 Detected: ${data.city}, ${data.region}, ${data.country_name}`;
                        
                        document.getElementById('confirmLocationBtn').disabled = false;
                        selectedLocation = { 
                            lat, 
                            lng, 
                            name: `${data.city}, ${data.region}, ${data.country_name}`,
                            isDetected: true 
                        };
                    } else {
                        throw new Error('No location data available');
                    }
                })
                .catch(error => {
                    console.error('IP location error:', error);
                    coordinates.textContent = '❌ Detection failed';
                    locationInfo.textContent = 'Please use GPS or search manually';
                });
        }
        
        function searchLocation() {
            const searchContainer = document.getElementById('searchContainer');
            searchContainer.style.display = searchContainer.style.display === 'none' ? 'flex' : 'none';
            
            if (searchContainer.style.display === 'flex') {
                document.getElementById('locationSearch').focus();
            }
        }
        
        function performLocationSearch() {
            const searchInput = document.getElementById('locationSearch');
            const query = searchInput.value.trim();
            
            if (!query) return;
            
            const coordinates = document.getElementById('coordinates');
            const locationInfo = document.getElementById('locationInfo');
            
            coordinates.textContent = 'Searching...';
            
            // Use Nominatim (OpenStreetMap) geocoding service
            fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query)}&format=json&limit=1`)
                .then(response => response.json())
                .then(data => {
                    if (data && data.length > 0) {
                        const result = data[0];
                        const lat = parseFloat(result.lat);
                        const lng = parseFloat(result.lon);
                        
                        currentMapCenter = { lat, lng };
                        
                        // Update map to searched location
                        const mapFrame = document.getElementById('mapFrame');
                        mapFrame.src = `https://www.openstreetmap.org/export/embed.html?bbox=${lng-0.01},${lat-0.01},${lng+0.01},${lat+0.01}&layer=mapnik&marker=${lat},${lng}`;
                        
                        updateCoordinatesDisplay(lat, lng);
                        locationInfo.textContent = `📍 ${result.display_name}`;
                        
                        document.getElementById('confirmLocationBtn').disabled = false;
                        selectedLocation = { lat, lng, name: result.display_name };
                        
                        // Hide search container
                        document.getElementById('searchContainer').style.display = 'none';
                        searchInput.value = '';
                    } else {
                        coordinates.textContent = 'Location not found';
                        locationInfo.textContent = 'Please try a different search term';
                    }
                })
                .catch(error => {
                    console.error('Search error:', error);
                    coordinates.textContent = 'Search failed';
                    locationInfo.textContent = 'Please try again';
                });
        }
        
        function setPinAtCenter() {
            const lat = currentMapCenter.lat;
            const lng = currentMapCenter.lng;
            
            updateCoordinatesDisplay(lat, lng);
            document.getElementById('locationInfo').textContent = '📍 Pin set at map center';
            document.getElementById('confirmLocationBtn').disabled = false;
            
            selectedLocation = { lat, lng };
        }
        
        function updateCoordinatesDisplay(lat, lng) {
            const coordinates = document.getElementById('coordinates');
            coordinates.textContent = `📍 ${lat.toFixed(6)}, ${lng.toFixed(6)}`;
        }
        
        function confirmLocation() {
            if (selectedLocation) {
                const locationInput = document.getElementById('profileLocation');
                const displayText = selectedLocation.name || 
                                  selectedLocation.isCurrentLocation ? 'Current Location' : 
                                  `${selectedLocation.lat.toFixed(4)}, ${selectedLocation.lng.toFixed(4)}`;
                
                locationInput.value = displayText;
                closeLocationPicker();
                
                // Store location data for later use
                locationInput.dataset.lat = selectedLocation.lat;
                locationInput.dataset.lng = selectedLocation.lng;
            }
        }
        
        // Age preference functions
        function updateAgeDisplay() {
            const minAge = document.getElementById('minAge').value;
            const maxAge = document.getElementById('maxAge').value;
            document.getElementById('minAgeValue').textContent = minAge;
            document.getElementById('maxAgeValue').textContent = maxAge;
            document.getElementById('ageRangeDisplay').textContent = `${minAge} - ${maxAge}`;
            
            // Ensure min age is not greater than max age
            if (parseInt(minAge) > parseInt(maxAge)) {
                if (event.target && event.target.id === 'minAge') {
                    document.getElementById('maxAge').value = minAge;
                    document.getElementById('maxAgeValue').textContent = minAge;
                } else {
                    document.getElementById('minAge').value = maxAge;
                    document.getElementById('minAgeValue').textContent = maxAge;
                }
                document.getElementById('ageRangeDisplay').textContent = `${document.getElementById('minAge').value} - ${document.getElementById('maxAge').value}`;
            }
        }
        
        function initializeAgeSliders() {
            const minAgeSlider = document.getElementById('minAge');
            const maxAgeSlider = document.getElementById('maxAge');
            
            if (minAgeSlider && maxAgeSlider) {
                minAgeSlider.addEventListener('input', updateAgeDisplay);
                maxAgeSlider.addEventListener('input', updateAgeDisplay);
                updateAgeDisplay(); // Initialize display
            }
        }
        
        // Helper function to handle search input with Enter key
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('locationSearch');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performLocationSearch();
                    }
                });
            }
            
            // Handle "Everyone" checkbox behavior
            const everyoneCheckbox = document.getElementById('lookingForEveryone');
            const otherCheckboxes = ['lookingForMen', 'lookingForWomen', 'lookingForNonBinary'];
            
            if (everyoneCheckbox) {
                everyoneCheckbox.addEventListener('change', function() {
                    if (this.checked) {
                        // If "Everyone" is checked, check all others and disable them
                        otherCheckboxes.forEach(id => {
                            const checkbox = document.getElementById(id);
                            if (checkbox) {
                                checkbox.checked = true;
                                checkbox.disabled = true;
                            }
                        });
                    } else {
                        // If "Everyone" is unchecked, enable others but don't uncheck them
                        otherCheckboxes.forEach(id => {
                            const checkbox = document.getElementById(id);
                            if (checkbox) {
                                checkbox.disabled = false;
                            }
                        });
                    }
                });
                
                // Handle individual checkboxes affecting "Everyone"
                otherCheckboxes.forEach(id => {
                    const checkbox = document.getElementById(id);
                    if (checkbox) {
                        checkbox.addEventListener('change', function() {
                            // If any individual checkbox is unchecked, uncheck "Everyone"
                            if (!this.checked) {
                                everyoneCheckbox.checked = false;
                                // Re-enable all checkboxes
                                otherCheckboxes.forEach(otherId => {
                                    const otherCheckbox = document.getElementById(otherId);
                                    if (otherCheckbox) {
                                        otherCheckbox.disabled = false;
                                    }
                                });
                            }
                        });
                    }
                });
            }
            
            // Initialize age preference sliders
            initializeAgeSliders();
        });
        
        function generateAddressFromCoords(lat, lng) {
            // Simulate reverse geocoding with realistic city names
            const cities = [
                'San Francisco, CA', 'New York, NY', 'Los Angeles, CA', 'Chicago, IL',
                'Houston, TX', 'Phoenix, AZ', 'Philadelphia, PA', 'San Antonio, TX',
                'San Diego, CA', 'Dallas, TX', 'San Jose, CA', 'Austin, TX'
            ];
            
            // Use coordinates to pick a city (simulated)
            const index = Math.abs(Math.floor((lat + lng) * 100)) % cities.length;
            return cities[index];
        }
        
        function confirmLocation() {
            if (!selectedLocation) return;
            
            const locationInput = document.getElementById('profileLocation');
            locationInput.value = selectedLocation.address;
            
            // Save coordinates for later use
            if (currentUser) {
                currentUser.coordinates = {
                    lat: selectedLocation.lat,
                    lng: selectedLocation.lng
                };
                localStorage.setItem(`dating_profile_${currentUser.phone}`, JSON.stringify({
                    ...currentUser,
                    coordinates: currentUser.coordinates
                }));
            }
            
            showLocationStatus(`Location set: ${selectedLocation.address}`, 'success');
            closeLocationPicker();
        }
        
        function showLocationStatus(message, type) {
            const statusEl = document.getElementById('locationStatus');
            statusEl.textContent = message;
            statusEl.className = `location-status ${type}`;
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 3000);
            }
        }
        
        // Prompt Functions
        function updatePromptPlaceholder(type) {
            const select = document.getElementById(type + 'Prompt');
            const textarea = document.getElementById(type + 'Answer');
            
            if (select.value) {
                textarea.placeholder = 'Share your answer here...';
                textarea.focus();
            } else {
                textarea.placeholder = 'Choose a question first...';
            }
        }
        
        // Character counting for prompts
        document.addEventListener('DOMContentLoaded', function() {
            ['personal', 'interest', 'hobby'].forEach(type => {
                const textarea = document.getElementById(type + 'Answer');
                const counter = document.getElementById(type + 'Count');
                
                if (textarea && counter) {
                    textarea.addEventListener('input', function() {
                        const length = this.value.length;
                        counter.textContent = length;
                        
                        const counterEl = counter.parentElement;
                        counterEl.classList.remove('warning', 'danger');
                        
                        if (length > 120) {
                            counterEl.classList.add('danger');
                        } else if (length > 100) {
                            counterEl.classList.add('warning');
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>
